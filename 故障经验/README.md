# 📚 STM32开发故障经验汇总

> **目的**：记录STM32开发过程中遇到的典型问题及解决方案  
> **受众**：所有STM32开发者  
> **更新日期**：2025-10-22

---

## 📖 文档列表

### 1. EEPROM设置不当导致无法二次烧录.md ⭐⭐⭐⭐⭐

**问题描述**：
- 第一次烧录程序成功
- 第二次烧录失败，调试器无法连接芯片

**根本原因**：
- `__HAL_AFIO_REMAP_SWJ_DISABLE()` 禁用了SWD调试接口

**解决方案**：
- 修改为 `__HAL_AFIO_REMAP_SWJ_NOJTAG()`

**适用场景**：
- 问题已经发生，需要排查和修复
- 了解问题的完整技术细节

**阅读时间**：15-20分钟

---

### 2. 新项目避免二次烧录问题指南.md ⭐⭐⭐⭐⭐

**目的**：
- 创建新项目时预防二次烧录问题
- 提供配置清单和验证方法

**主要内容**：
- STM32CubeMX正确配置方法
- 代码检查要点
- Keil/IAR调试器配置
- 验证步骤
- 快速检查表

**适用场景**：
- 创建新的STM32项目
- 项目配置验收
- 团队培训

**阅读时间**：10-15分钟

---

## 🎯 使用建议

### 如果您是新手

**推荐阅读顺序**：
```
1. 先读：新项目避免二次烧录问题指南.md
   ↓ 了解如何预防
   ↓
2. 再读：EEPROM设置不当导致无法二次烧录.md
   ↓ 了解技术细节
```

### 如果遇到问题

**推荐阅读顺序**：
```
1. 先读：EEPROM设置不当导致无法二次烧录.md
   ↓ 理解问题和解决方案
   ↓
2. 再读：新项目避免二次烧录问题指南.md
   ↓ 预防未来项目出现同样问题
```

### 如果要做代码审查

**推荐使用**：
```
新项目避免二次烧录问题指南.md
  ↓
使用其中的"快速检查表"
  ↓
验证项目配置是否正确
```

---

## 🔍 问题快速定位

### 症状：第一次烧录成功，第二次失败

**立即查看**：
```
EEPROM设置不当导致无法二次烧录.md
  → 第2章：问题排查过程
  → 第3章：完整解决方案
```

### 症状：新项目想避免此问题

**立即查看**：
```
新项目避免二次烧录问题指南.md
  → 第1章：预防清单
  → 第6章：快速检查表
```

### 症状：不确定CubeMX如何配置

**立即查看**：
```
新项目避免二次烧录问题指南.md
  → 第1章第1节：STM32CubeMX配置阶段
```

### 症状：代码已生成，想检查是否正确

**立即查看**：
```
新项目避免二次烧录问题指南.md
  → 第1章第2节：代码生成后检查
```

---

## 💡 核心知识点

### 最重要的三点

1. **CubeMX配置**
   ```
   System Core → SYS → Debug: Serial Wire  ✅
   （不要选 Disable ❌）
   ```

2. **代码检查**
   ```c
   // 在 stm32xxx_hal_msp.c 中
   __HAL_AFIO_REMAP_SWJ_NOJTAG();  ✅ 正确
   __HAL_AFIO_REMAP_SWJ_DISABLE(); ❌ 错误
   ```

3. **立即验证**
   ```
   第一次烧录后，立即测试第二次烧录
   必须成功才算配置正确
   ```

---

## 🎓 技术要点

### SWD vs JTAG

**SWD（Serial Wire Debug）**：
- 只用2根线（SWDIO、SWCLK）
- 适合引脚资源紧张的项目
- STM32开发主流方式

**JTAG**：
- 用5根线
- 功能更强大
- 占用更多引脚

### 三种配置对比

| 配置 | 宏定义 | SWD | JTAG | 释放引脚 | 推荐 |
|------|--------|-----|------|---------|------|
| 全启用 | SWJ_ENABLE | ✅ | ✅ | 0个 | ⭐⭐⭐ |
| 仅SWD | SWJ_NOJTAG | ✅ | ❌ | 3个 | ⭐⭐⭐⭐⭐ |
| 全禁用 | SWJ_DISABLE | ❌ | ❌ | 5个 | ❌ |

**开发阶段推荐**：`SWJ_NOJTAG`

---

## 📋 快速参考

### 问题诊断流程图

```
遇到二次烧录问题
    ↓
检查 HAL_MspInit() 函数
    ↓
是否使用 SWJ_DISABLE？
    ↓ 是
修改为 SWJ_NOJTAG
    ↓
重新编译烧录
    ↓
测试第二次烧录
    ↓ 成功
问题解决 ✅
```

### 新项目配置流程图

```
创建CubeMX项目
    ↓
System → SYS → Debug: Serial Wire
    ↓
生成代码
    ↓
检查 HAL_MspInit()
    ↓
配置 Connect Under Reset
    ↓
首次烧录
    ↓
立即测试第二次烧录
    ↓ 成功
配置正确 ✅
```

---

## 🔧 工具和资源

### 检查工具

**代码检查命令**（Git Bash）：
```bash
grep -n "SWJ_DISABLE" Core/Src/*.c
```
如果有输出 → 需要修改

**PowerShell检查**：
```powershell
Select-String -Path "Core\Src\*.c" -Pattern "SWJ_DISABLE"
```

### 相关软件

- **STM32CubeMX**：项目配置工具
- **Keil MDK**：主要开发IDE
- **J-Link Software**：调试器驱动
- **ST-Link Utility**：ST官方烧录工具

---

## 📞 获取帮助

### 文档内求助

1. **查看问题解决文档**
   - EEPROM设置不当导致无法二次烧录.md
   - 包含详细的恢复方法

2. **查看FAQ**
   - 两个文档都包含常见问题解答

3. **使用索引**
   - 通过关键词快速定位章节

### 外部资源

1. **ST官方社区**
   - https://community.st.com/

2. **STM32中文论坛**
   - 国内开发者交流平台

3. **GitHub Issues**
   - 搜索类似问题的解决方案

---

## 🎯 文档维护

### 更新记录

| 日期 | 版本 | 更新内容 |
|------|------|---------|
| 2025-10-22 | v1.0 | 初始版本，包含二次烧录问题文档 |

### 未来计划

可能添加的故障经验：
- [ ] I2C通信超时问题
- [ ] 中断优先级配置错误
- [ ] 时钟配置常见问题
- [ ] DMA使用注意事项
- [ ] Flash擦写问题

---

## 📝 贡献指南

### 添加新的故障经验

**文档结构**：
```
1. 问题描述
2. 问题排查过程
3. 根本原因分析
4. 解决方案（多种）
5. 预防措施
6. 验证方法
7. 最佳实践
```

**命名规范**：
```
[问题现象]导致[具体后果].md

例如：
- EEPROM设置不当导致无法二次烧录.md
- 中断优先级配置错误导致系统死锁.md
```

---

<div align="center">

## ✅ 使用此文档库的好处

**个人开发者**：
- ✅ 避免踩坑
- ✅ 快速解决问题
- ✅ 提高开发效率

**团队开发**：
- ✅ 统一最佳实践
- ✅ 减少重复问题
- ✅ 知识传承

**项目管理**：
- ✅ 降低风险
- ✅ 提高质量
- ✅ 缩短开发周期

---

**让经验成为资产，让问题不再重复！** 💪

</div>

