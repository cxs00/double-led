# 信号定义和时序

> **项目**: STM32双数码管显示系统  
> **硬件版本**: v1.0.1  
> **最后更新**: 2025-10-25  
> **状态**: ✅ 活跃开发中  

---

## 🎯 信号系统概述

### 信号分类
```
信号系统分类:
├── SPI2通信信号 ────→ STM32 ↔ 74HC595/165
├── 显示控制信号 ────→ 74HC595 → 数码管/LED
├── 按键扫描信号 ────→ 按键 → 74HC165 → STM32
├── 调试接口信号 ────→ J-Link ↔ STM32
└── 电源管理信号 ────→ 电源系统
```

### 信号流向图
```
STM32F103C8T6
├── SPI2输出 ────→ 74HC595级联 ────→ 显示系统
├── SPI2输入 ←──── 74HC165 ←──── 按键矩阵
├── SWD接口 ←──── J-Link调试器
└── 电源管理 ←──── 3.3V电源系统
```

---

## ⚡ SPI2通信信号

### SPI2信号定义
```
SPI2接口信号:
├── PB13 (SPI2_SCK) ────→ 时钟信号 (9MHz)
├── PB15 (SPI2_MOSI) ────→ 主设备输出，从设备输入
├── PB14 (SPI2_MISO) ←─── 主设备输入，从设备输出
└── PB7 (LATCH) ────────→ 锁存控制信号
```

### SPI2时序规范
```
SPI2时序参数:
├── 时钟频率: 9MHz
├── 时钟占空比: 50%
├── 数据位宽: 8位
├── 传输模式: 全双工
├── 时钟极性: CPOL = 0 (空闲时低电平)
├── 时钟相位: CPHA = 0 (第一个边沿采样)
└── 字节序: MSB先传输
```

### SPI2时序图
```
SPI2时序图:
SCK  ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐
     │ │   │ │   │ │   │ │   │ │   │ │   │ │   │ │   │ │
     └─┘   └─┘   └─┘   └─┘   └─┘   └─┘   └─┘   └─┘   └─┘
MOSI ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐
     │D7│D6│D5│D4│D3│D2│D1│D0│
     └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘
MISO ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐
     │K7│K6│K5│K4│K3│K2│K1│K0│
     └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘
LATCH                    ┌─┐
                         │ │
                         └─┘
```

### SPI2数据格式
```
SPI2数据格式:
├── 显示数据 (24位):
│   ├── U1数据 (8位): D7段码 + LED阴极
│   ├── U2数据 (8位): 位选择 + LED阳极
│   └── U6数据 (8位): D8段码
├── 按键数据 (9位):
│   ├── SER位: 按键9状态
│   └── D0-D7位: 按键1-8状态
└── 传输顺序: MSB先传输
```

---

## 🔌 74HC595级联信号

### 74HC595信号定义
```
74HC595信号:
├── SER ──────→ 串行数据输入
├── SRCLK ────→ 移位寄存器时钟
├── RCLK ──────→ 存储寄存器时钟
├── QA-QH ────→ 并行数据输出
└── QH' ──────→ 级联输出 (到下一级SER)
```

### 74HC595时序规范
```
74HC595时序参数:
├── 时钟频率: 9MHz
├── 时钟占空比: 50%
├── 建立时间: >10ns
├── 保持时间: >10ns
├── 传输延迟: <100ns
├── 锁存延迟: <50ns
└── 级联延迟: <200ns
```

### 74HC595时序图
```
74HC595时序图:
SRCLK ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐
      │ │   │ │   │ │   │ │   │ │   │ │   │ │   │ │
      └─┘   └─┘   └─┘   └─┘   └─┘   └─┘   └─┘   └─┘
SER   ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐
      │D7│D6│D5│D4│D3│D2│D1│D0│
      └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘
RCLK                    ┌─┐
                        │ │
                        └─┘
QA-QH  ┌─────────────────────────────────────────┐
       │ 数据锁存到输出                           │
       └─────────────────────────────────────────┘
```

### 74HC595级联时序
```
74HC595级联时序:
├── 级联顺序: STM32 → U1 → U2 → U6
├── 级联延迟: 每级延迟<200ns
├── 总延迟: <600ns (3级级联)
├── 数据流向: STM32 → U1 → U2 → U6
└── 锁存同步: 所有级联芯片同时锁存
```

---

## 📡 74HC165按键扫描信号

### 74HC165信号定义
```
74HC165信号:
├── SER ──────→ 串行数据输入 (按键9)
├── D0-D7 ────→ 并行数据输入 (按键1-8)
├── CLK ──────→ 移位时钟
├── SH/LD ────→ 移位/加载控制
└── QH ───────→ 串行数据输出
```

### 74HC165时序规范
```
74HC165时序参数:
├── 时钟频率: 9MHz
├── 时钟占空比: 50%
├── 建立时间: >10ns
├── 保持时间: >10ns
├── 传输延迟: <100ns
├── 加载延迟: <50ns
└── 扫描频率: 100Hz
```

### 74HC165时序图
```
74HC165时序图:
SH/LD ┌─┐
      │ │
      └─┘
CLK   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐
      │ │   │ │   │ │   │ │   │ │   │ │   │ │   │ │   │ │
      └─┘   └─┘   └─┘   └─┘   └─┘   └─┘   └─┘   └─┘   └─┘
QH    ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐
      │K8│K7│K6│K5│K4│K3│K2│K1│K0│
      └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘
```

### 74HC165扫描流程
```
74HC165扫描流程:
├── 1. 发送SH/LD=0信号，加载按键状态
├── 2. 发送SH/LD=1信号，开始移位
├── 3. 发送9个CLK时钟，移位9位数据
├── 4. 通过QH接收9位按键数据
├── 5. 处理按键数据，检测按键状态
└── 6. 等待10ms，进行下一次扫描
```

---

## 💡 显示控制信号

### 数码管段码信号
```
数码管段码信号:
├── D7段码 (U1输出):
│   ├── a段 ──────→ D7段码a
│   ├── b段 ──────→ D7段码b
│   ├── c段 ──────→ D7段码c
│   ├── d段 ──────→ D7段码d
│   ├── e段 ──────→ D7段码e
│   ├── f段 ──────→ D7段码f
│   ├── g段 ──────→ D7段码g
│   └── dp段 ──────→ D7段码dp
├── D8段码 (U6输出):
│   ├── a段 ──────→ D8段码a
│   ├── b段 ──────→ D8段码b
│   ├── c段 ──────→ D8段码c
│   ├── d段 ──────→ D8段码d
│   ├── e段 ──────→ D8段码e
│   ├── f段 ──────→ D8段码f
│   ├── g段 ──────→ D8段码g
│   └── dp段 ──────→ D8段码dp
```

### 数码管位选信号
```
数码管位选信号:
├── D7位选 (U2输出):
│   ├── 位1 ──────→ D7位1选择
│   ├── 位2 ──────→ D7位2选择
│   ├── 位3 ──────→ D7位3选择
│   ├── 位4 ──────→ D7位4选择
│   └── 位5 ──────→ D7位5选择
├── D8位选 (复用U2输出):
│   ├── 位1 ──────→ D8位1选择 (复用D7位1)
│   ├── 位2 ──────→ D8位2选择 (复用D7位2)
│   ├── 位3 ──────→ D8位3选择 (复用D7位3)
│   ├── 位4 ──────→ D8位4选择 (复用D7位4)
│   └── 位5 ──────→ D8位5选择 (复用D7位5)
```

### LED控制信号
```
LED控制信号:
├── LED阴极 (U1输出):
│   └── QH ──────→ LED阴极控制
├── LED阳极 (U2输出，PNP反相):
│   ├── QF ──────→ Hz LED阳极
│   ├── QG ──────→ A LED阳极
│   └── QH ──────→ V LED阳极
└── LED功能:
    ├── Hz LED ──────→ 频率单位指示
    ├── A LED ───────→ 电流单位指示
    ├── V LED ───────→ 电压单位指示
    ├── ALM LED ──────→ 报警指示
    ├── F/R LED ──────→ 正反转指示
    └── RUN LED ──────→ 运行状态指示
```

---

## 🐛 SWD调试接口信号

### SWD信号定义
```
SWD接口信号:
├── PA13 (SWDIO) ────→ 调试数据输入输出
├── PA14 (SWCLK) ────→ 调试时钟输出
├── VCC ────────────→ 3.3V供电
└── GND ────────────→ 电源地
```

### SWD时序规范
```
SWD时序参数:
├── 时钟频率: 最高10MHz
├── 时钟占空比: 50%
├── 建立时间: >10ns
├── 保持时间: >10ns
├── 传输延迟: <100ns
├── 协议: SWD (Serial Wire Debug)
└── 数据位宽: 1位 (串行)
```

### SWD时序图
```
SWD时序图:
SWCLK ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐   ┌─┐
       │ │   │ │   │ │   │ │   │ │   │ │   │ │   │ │
       └─┘   └─┘   └─┘   └─┘   └─┘   └─┘   └─┘   └─┘
SWDIO  ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐
       │D7│D6│D5│D4│D3│D2│D1│D0│
       └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘
```

---

## ⚡ 电源管理信号

### 电源信号定义
```
电源信号:
├── VCC ────────────→ 3.3V供电
├── GND ────────────→ 电源地
├── 3.3V ────────────→ 主电源
├── GND ────────────→ 电源地
└── 电源滤波 ────────→ 电源滤波信号
```

### 电源时序规范
```
电源时序参数:
├── 上电时间: <100ms
├── 下电时间: <10ms
├── 电源稳定时间: <50ms
├── 电源纹波: <50mV
├── 电源噪声: <10mV
└── 电源稳定性: ±1%
```

### 电源时序图
```
电源时序图:
VCC   ┌─────────────────────────────────────────┐
      │ 3.3V稳定供电                             │
      └─────────────────────────────────────────┘
GND   ┌─────────────────────────────────────────┐
      │ 0V电源地                                 │
      └─────────────────────────────────────────┘
纹波  ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐
      │ │ │ │ │ │ │ │ │ │ │ │ │ │ │ │
      └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘ └─┘
```

---

## 🔄 信号同步和时序

### 系统时序关系
```
系统时序关系:
├── 主时钟: 72MHz (STM32F103C8T6)
├── SPI时钟: 9MHz (SPI2接口)
├── 显示刷新: 1000Hz (1ms周期)
├── 按键扫描: 100Hz (10ms周期)
├── 调试时钟: 最高10MHz (SWD接口)
└── 电源管理: 连续监控
```

### 时序同步要求
```
时序同步要求:
├── SPI同步: 所有SPI信号必须同步
├── 显示同步: 显示数据必须同步更新
├── 按键同步: 按键扫描必须同步
├── 调试同步: 调试信号必须同步
└── 电源同步: 电源管理必须同步
```

### 时序约束
```
时序约束:
├── 建立时间: >10ns
├── 保持时间: >10ns
├── 传输延迟: <100ns
├── 时钟偏移: <1ns
├── 抖动: <0.1ns
└── 相位关系: 严格同步
```

---

## 🔧 信号完整性设计

### 信号完整性要求
```
信号完整性要求:
├── 信号质量: 良好的信号质量
├── 信号完整性: 完整的信号完整性
├── 电源完整性: 完整的电源完整性
├── 地线完整性: 完整的地线完整性
└── 电磁兼容性: 良好的电磁兼容性
```

### 信号完整性措施
```
信号完整性措施:
├── 短距离连接: 减少信号传输距离
├── 阻抗匹配: 保持信号阻抗匹配
├── 电源滤波: 加强电源滤波
├── 地线设计: 优化地线设计
└── 屏蔽设计: 增加屏蔽设计
```

### 信号完整性测试
```
信号完整性测试:
├── 信号质量测试: 测试信号质量
├── 时序测试: 测试时序参数
├── 电源测试: 测试电源参数
├── 地线测试: 测试地线参数
└── 电磁兼容性测试: 测试电磁兼容性
```

---

## 📊 信号性能参数

### 信号性能指标
```
信号性能指标:
├── 时钟频率: 9MHz (SPI2)
├── 数据速率: 9Mbps (SPI2)
├── 传输延迟: <100ns
├── 建立时间: >10ns
├── 保持时间: >10ns
├── 时钟偏移: <1ns
├── 抖动: <0.1ns
└── 相位关系: 严格同步
```

### 信号质量指标
```
信号质量指标:
├── 信号幅度: 3.3V ±5%
├── 信号噪声: <10mV
├── 信号失真: <1%
├── 信号完整性: >95%
├── 电源纹波: <50mV
├── 电源噪声: <10mV
├── 地线噪声: <5mV
└── 电磁兼容性: 符合标准
```

---

## 🎯 信号优化建议

### 1️⃣ 信号质量优化
```
信号质量优化:
├── 信号完整性优化: 优化信号完整性
├── 电源完整性优化: 优化电源完整性
├── 地线完整性优化: 优化地线完整性
├── 电磁兼容性优化: 优化电磁兼容性
└── 信号质量监控: 监控信号质量
```

### 2️⃣ 时序优化
```
时序优化:
├── 时序参数优化: 优化时序参数
├── 时钟质量优化: 优化时钟质量
├── 相位关系优化: 优化相位关系
├── 同步机制优化: 优化同步机制
└── 时序性能监控: 监控时序性能
```

### 3️⃣ 功耗优化
```
功耗优化:
├── 动态功耗优化: 优化动态功耗
├── 静态功耗优化: 优化静态功耗
├── 电源管理优化: 优化电源管理
├── 时钟管理优化: 优化时钟管理
└── 功耗监控: 监控功耗
```

---

## 📞 技术支持

### 🆘 信号问题诊断
```
信号问题诊断:
├── 信号质量问题: 检查信号质量和完整性
├── 时序问题: 检查时序参数和时钟质量
├── 电源问题: 检查电源参数和电源完整性
├── 地线问题: 检查地线参数和地线完整性
└── 电磁兼容性问题: 检查电磁兼容性
```

### 📚 学习资源
```
学习资源:
├── 技术文档: 完整的信号技术文档
├── 故障经验: 丰富的信号故障经验
├── 最佳实践: 信号设计最佳实践
└── 开发指南: 信号开发指南
```

### 🤝 协作支持
```
协作支持:
├── 开发协作: 信号开发协作指南
├── 版本管理: 信号版本控制和更新管理
├── 文档维护: 信号文档更新和维护
└── 技术支持: 信号技术问题支持
```

---

<div align="center">

## ⚡ 信号定义完成！

**完整的信号定义和时序设计！** 🔧

**信号清晰 + 时序准确 + 完整性好 + 性能优**

**让STM32硬件开发更专业，让嵌入式系统更可靠！** 💪

</div>
