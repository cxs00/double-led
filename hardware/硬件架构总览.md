# 硬件架构总览

> **项目**: STM32双数码管显示系统  
> **硬件版本**: v1.0.1  
> **最后更新**: 2025-10-25  
> **状态**: ✅ 活跃开发中  

---

## 🎯 系统架构概述

### 整体架构
```
┌─────────────────────────────────────────────────────────────┐
│                    STM32双数码管显示系统                      │
├─────────────────────────────────────────────────────────────┤
│  STM32F103C8T6 (主控)                                       │
│  ├── SPI2接口 (9MHz)                                        │
│  ├── SWD调试接口                                            │
│  └── 电源管理 (3.3V)                                        │
├─────────────────────────────────────────────────────────────┤
│  74HC595级联显示驱动 (3片)                                  │
│  ├── U1: D7段码 + LED阴极控制                               │
│  ├── U2: 位选择 + LED阳极控制 (PNP反相)                     │
│  └── U6: D8段码控制                                         │
├─────────────────────────────────────────────────────────────┤
│  74HC165按键扫描 (1片)                                      │
│  └── 9位按键矩阵扫描                                        │
├─────────────────────────────────────────────────────────────┤
│  显示系统                                                   │
│  ├── D7: 5位数码管 (频率显示)                               │
│  ├── D8: 5位数码管 (电流显示)                               │
│  └── LED: 6个状态指示LED                                    │
└─────────────────────────────────────────────────────────────┘
```

### 核心特性
- **主控芯片**: STM32F103C8T6 (ARM Cortex-M3, 72MHz)
- **显示驱动**: 3×74HC595级联 (24位输出)
- **按键扫描**: 1×74HC165 (9位输入)
- **通信接口**: SPI2 (9MHz全双工)
- **调试接口**: SWD (Serial Wire Debug)
- **电源系统**: 3.3V单电源供电

---

## 🔌 芯片连接关系

### STM32F103C8T6 ↔ 74HC595级联
```
STM32F103C8T6                   74HC595级联
├── PB13 (SPI2_SCK)     ──────→ U1.SRCLK, U2.SRCLK, U6.SRCLK
├── PB15 (SPI2_MOSI)    ──────→ U1.SER
├── PB7 (LATCH)         ──────→ U1.RCLK, U2.RCLK, U6.RCLK
└── 3.3V电源            ──────→ VCC
```

### 74HC595级联连接
```
U1 (D7段码+LED阴极) → U2 (位选择+LED阳极) → U6 (D8段码)
├── U1.QH ──────→ U2.SER
├── U2.QH ──────→ U6.SER
└── 级联数据流: STM32 → U1 → U2 → U6
```

### STM32F103C8T6 ↔ 74HC165
```
STM32F103C8T6                   74HC165
├── PB13 (SPI2_SCK)     ──────→ CLK
├── PB14 (SPI2_MISO)    ←────── QH
├── PB7 (LATCH)         ──────→ SH/LD
└── 3.3V电源            ──────→ VCC
```

### 显示系统连接
```
74HC595输出 → 显示系统
├── U1输出 → D7段码 + LED阴极
├── U2输出 → 位选择 + LED阳极
└── U6输出 → D8段码
```

---

## ⚡ 信号流向分析

### 显示数据流
```
STM32F103C8T6 → SPI2 → 74HC595级联 → 显示系统
├── 段码数据: STM32 → U1 → D7段码
├── 位选数据: STM32 → U1 → U2 → 位选择
├── LED数据: STM32 → U1 → LED阴极, U2 → LED阳极
└── D8数据: STM32 → U1 → U2 → U6 → D8段码
```

### 按键数据流
```
按键矩阵 → 74HC165 → SPI2 → STM32F103C8T6
├── 按键状态: 按键 → 74HC165 → SPI2.MISO → STM32
├── 扫描控制: STM32 → SPI2.MOSI → 74HC165.SH/LD
└── 时钟同步: STM32 → SPI2.SCK → 74HC165.CLK
```

### 调试数据流
```
J-Link调试器 ↔ SWD接口 ↔ STM32F103C8T6
├── 调试数据: J-Link ↔ PA13 (SWDIO) ↔ STM32
├── 调试时钟: J-Link ↔ PA14 (SWCLK) ↔ STM32
└── 调试控制: J-Link ↔ STM32调试模块
```

---

## 🔧 硬件模块详解

### 1️⃣ STM32F103C8T6主控模块
```
功能: 系统主控制器
特性:
├── ARM Cortex-M3内核 (72MHz)
├── 64KB Flash, 20KB SRAM
├── 37个GPIO引脚
├── 3个SPI接口 (SPI1/SPI2/SPI3)
├── 2个I2C接口
├── 3个USART接口
├── 2个定时器 (TIM2/TIM3)
└── SWD调试接口
```

### 2️⃣ 74HC595级联显示驱动
```
U1 (D7段码+LED阴极控制):
├── 功能: D7段码控制 + LED阴极控制
├── 输入: STM32 SPI2.MOSI
├── 输出: D7段码 (a,b,c,d,e,f,g,dp) + LED阴极
└── 级联: U1.QH → U2.SER

U2 (位选择+LED阳极控制):
├── 功能: 位选择 + LED阳极控制 (PNP反相)
├── 输入: U1.QH
├── 输出: 位选择信号 + LED阳极 (反相输出)
└── 级联: U2.QH → U6.SER

U6 (D8段码控制):
├── 功能: D8段码控制
├── 输入: U2.QH
├── 输出: D8段码 (a,b,c,d,e,f,g,dp)
└── 级联: 最后一级
```

### 3️⃣ 74HC165按键扫描
```
功能: 9位按键矩阵扫描
特性:
├── 输入: 9个按键 (SER + D0-D7)
├── 输出: 串行数据到STM32
├── 控制: 移位/加载控制
├── 时钟: SPI2时钟同步
└── 扫描: 100Hz扫描频率
```

### 4️⃣ 显示系统
```
D7数码管 (频率显示):
├── 类型: 5位7段数码管
├── 功能: 频率值显示 (0.00-400.00Hz)
├── 段码: a,b,c,d,e,f,g,dp
├── 位选: 5个位选择信号
└── 控制: U1段码输出

D8数码管 (电流显示):
├── 类型: 5位7段数码管
├── 功能: 电流值显示 (0.00-999.99A)
├── 段码: a,b,c,d,e,f,g,dp
├── 位选: 5个位选择信号
└── 控制: U6段码输出

LED状态指示 (6个):
├── Hz: 频率单位指示
├── A: 电流单位指示
├── V: 电压单位指示
├── ALM: 报警指示
├── F/R: 正反转指示
└── RUN: 运行状态指示
```

---

## 🔄 系统工作流程

### 1️⃣ 系统初始化
```
上电复位 → STM32启动 → 外设初始化 → 显示初始化
├── STM32F103C8T6启动
├── SPI2接口初始化 (9MHz)
├── 74HC595级联初始化
├── 74HC165按键扫描初始化
├── 显示系统初始化
└── 系统就绪
```

### 2️⃣ 显示更新流程
```
显示数据更新 → SPI2传输 → 74HC595级联 → 显示输出
├── 计算显示数据 (段码+位选)
├── SPI2发送数据到74HC595
├── 74HC595级联移位
├── LATCH信号锁存
└── 显示更新完成
```

### 3️⃣ 按键扫描流程
```
按键扫描 → 74HC165读取 → SPI2接收 → 按键处理
├── 发送SH/LD信号加载按键状态
├── SPI2接收9位按键数据
├── 按键状态解析
├── 按键功能处理
└── 按键响应完成
```

### 4️⃣ 调试流程
```
调试器连接 → SWD通信 → 程序下载/调试
├── J-Link连接SWD接口
├── SWD协议通信
├── 程序下载到Flash
├── 断点调试
└── 变量监控
```

---

## 📊 性能参数

### 系统性能
- **主频**: 72MHz (STM32F103C8T6)
- **SPI频率**: 9MHz
- **显示刷新**: 1000Hz (1ms)
- **按键扫描**: 100Hz (10ms)
- **响应时间**: <1ms

### 功耗特性
- **工作电压**: 3.3V
- **工作电流**: <150mA
- **待机电流**: <10μA
- **功耗优化**: 动态扫描降低功耗

### 可靠性指标
- **工作温度**: -40°C ~ +85°C
- **存储温度**: -55°C ~ +125°C
- **湿度范围**: 10% ~ 90% RH
- **MTBF**: >100,000小时

---

## 🔧 硬件约束

### 引脚分配约束
- **调试接口**: PA13/PA14 (SWD专用)
- **SPI2接口**: PB13/PB14/PB15/PB7 (固定分配)
- **电源引脚**: VCC/GND (3.3V供电)
- **晶振引脚**: PA8/PA9 (外部晶振)

### 信号完整性约束
- **SPI信号**: 9MHz时钟，需要良好的信号完整性
- **显示信号**: 动态扫描，需要稳定的电源
- **按键信号**: 需要去抖动处理
- **调试信号**: 需要短距离连接

### 电源约束
- **供电电压**: 3.3V ±5%
- **供电电流**: 最大150mA
- **电源纹波**: <50mV
- **电源稳定性**: 需要良好的电源滤波

---

## 🎯 设计优势

### 1️⃣ 模块化设计
- **显示模块**: 独立的74HC595级联
- **按键模块**: 独立的74HC165扫描
- **主控模块**: 独立的STM32F103C8T6
- **调试模块**: 独立的SWD接口

### 2️⃣ 可扩展性
- **显示扩展**: 可增加更多数码管
- **按键扩展**: 可增加更多按键
- **功能扩展**: 可增加更多外设
- **接口扩展**: 可增加更多通信接口

### 3️⃣ 可维护性
- **模块替换**: 各模块可独立替换
- **故障诊断**: 清晰的信号流向
- **调试便利**: 完整的调试接口
- **文档完整**: 详细的硬件文档

### 4️⃣ 成本优化
- **芯片选择**: 性价比较高的芯片
- **电路简化**: 最小化电路复杂度
- **功耗优化**: 低功耗设计
- **批量生产**: 适合批量生产

---

## 📞 技术支持

### 🆘 故障诊断
- **显示问题**: 检查74HC595连接和SPI信号
- **按键问题**: 检查74HC165连接和扫描信号
- **调试问题**: 检查SWD接口连接
- **电源问题**: 检查3.3V供电和电源滤波

### 📚 学习资源
- **技术文档**: 完整的硬件技术文档
- **故障经验**: 丰富的故障诊断经验
- **最佳实践**: 硬件设计最佳实践
- **开发指南**: 硬件开发指南

### 🤝 协作支持
- **开发协作**: 硬件开发协作指南
- **版本管理**: 版本控制和更新管理
- **文档维护**: 文档更新和维护
- **技术支持**: 技术问题支持

---

<div align="center">

## 🏗️ 硬件架构完成！

**完整的硬件架构设计！** 🔧

**模块化设计 + 可扩展性 + 可维护性 + 成本优化**

**让STM32硬件开发更专业，让嵌入式系统更可靠！** 💪

</div>
