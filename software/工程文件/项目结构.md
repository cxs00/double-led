# 项目结构说明

## 🏗️ 整体架构

### 硬件架构
```
STM32F103C8T6 (主控)
    ↓
SPI2总线
    ↓
74HC595×3 (显示驱动) ←→ 数码管D7/D8 + LED×6
74HC165 (按键输入) ←→ 按键矩阵×9
```

### 软件架构
```
应用层
├── 菜单系统 (menu_system.c)
├── 显示系统 (segment_display.c)
└── 按键系统 (key.c)
    ↓
驱动层
├── 74HC595驱动 (hc595.c)
├── SPI显示驱动 (spi_display.c)
└── 74HC165驱动 (key.c)
    ↓
HAL层
├── STM32 HAL库
├── SPI驱动
└── GPIO驱动
    ↓
硬件层
├── STM32F103C8T6
├── 74HC595×3
└── 74HC165
```

## 📁 文件组织结构

### 源代码文件
```
Core/
├── Inc/                    ← 头文件目录
│   ├── main.h             ← 主程序头文件
│   ├── hc595.h            ← 74HC595驱动头文件
│   ├── key.h              ← 按键处理头文件
│   ├── segment_display.h  ← 数码管显示头文件
│   ├── spi_display.h      ← SPI显示头文件
│   ├── menu_system.h      ← 菜单系统头文件
│   ├── stm32f1xx_hal_conf.h ← HAL库配置
│   └── stm32f1xx_it.h     ← 中断处理头文件
└── Src/                   ← 源文件目录
    ├── main.c             ← 主程序源文件
    ├── hc595.c            ← 74HC595驱动源文件
    ├── key.c              ← 按键处理源文件
    ├── segment_display.c  ← 数码管显示源文件
    ├── spi_display.c      ← SPI显示源文件
    ├── menu_system.c      ← 菜单系统源文件
    ├── stm32f1xx_hal_msp.c ← HAL库MSP源文件
    ├── stm32f1xx_it.c     ← 中断处理源文件
    └── system_stm32f1xx.c ← 系统初始化源文件
```

### 库文件
```
Drivers/
├── CMSIS/                    ← ARM CMSIS库
│   ├── Core/                ← 核心文件
│   ├── Device/              ← 设备文件
│   ├── DSP/                 ← 数字信号处理
│   ├── Include/             ← 包含文件
│   ├── Lib/                 ← 库文件
│   ├── NN/                  ← 神经网络
│   ├── RTOS/                ← 实时操作系统
│   └── RTOS2/               ← 实时操作系统2
└── STM32F1xx_HAL_Driver/     ← STM32F1 HAL驱动
    ├── Inc/                 ← 头文件
    ├── Src/                 ← 源文件
    └── LICENSE.txt          ← 许可证
```

### 项目文件
```
MDK-ARM/
├── 500 double led/           ← 编译输出
├── 500 double led.uvguix.xx  ← Keil用户界面
├── 500 double led.uvoptx     ← Keil选项
├── DebugConfig/              ← 调试配置
├── JLinkLog.txt              ← J-Link日志
├── JLinkSettings.ini         ← J-Link设置
├── RTE/                      ← 运行时环境
├── startup_stm32f103xb.lst   ← 启动文件列表
└── startup_stm32f103xb.s     ← 启动汇编
```

## 🔧 模块功能

### 主程序模块 (main.c)
- **功能：** 系统初始化和主循环
- **职责：** 协调各模块工作
- **关键函数：**
  - `MX_GPIO_Init()` - GPIO初始化
  - `MX_SPI2_Init()` - SPI2初始化
  - `main()` - 主循环

### 74HC595驱动模块 (hc595.c)
- **功能：** 控制74HC595芯片
- **职责：** 数码管段码和位码控制
- **关键函数：**
  - `HC595_Init()` - 初始化
  - `HC595_SendData()` - 发送数据
  - `HC595_Refresh()` - 刷新显示

### 按键处理模块 (key.c)
- **功能：** 处理74HC165按键输入
- **职责：** 按键扫描和消抖
- **关键函数：**
  - `KEY_Init()` - 初始化
  - `KEY_Read()` - 读取按键状态
  - `KEY_Scan()` - 按键扫描

### 数码管显示模块 (segment_display.c)
- **功能：** 数码管显示控制
- **职责：** 段码表和显示逻辑
- **关键函数：**
  - `SEG_Init()` - 初始化
  - `SEG_DisplayNumber()` - 显示数字
  - `SEG_DisplayFrequency()` - 显示频率

### SPI显示模块 (spi_display.c)
- **功能：** SPI通信控制
- **职责：** SPI数据传输
- **关键函数：**
  - `SPI_Display_Init()` - 初始化
  - `SPI_Display_Send()` - 发送数据
  - `SPI_Display_Refresh()` - 刷新显示

### 菜单系统模块 (menu_system.c)
- **功能：** 多级菜单处理
- **职责：** 菜单导航和参数设置
- **关键函数：**
  - `MENU_Init()` - 初始化
  - `MENU_ProcessKey()` - 处理按键
  - `MENU_Display()` - 显示菜单

## 🔄 数据流

### 显示数据流
```
频率数据 → segment_display.c → 段码表 → hc595.c → 74HC595 → 数码管
```

### 按键数据流
```
按键按下 → 74HC165 → key.c → 按键处理 → main.c → 功能执行
```

### SPI数据流
```
STM32 → SPI2 → 74HC595/74HC165 → 显示/按键
```

## ⚙️ 配置参数

### 硬件配置
- **SPI2频率：** 8MHz
- **显示刷新：** 50Hz
- **按键扫描：** 20Hz
- **长按阈值：** 250ms

### 软件配置
- **频率范围：** 0.00-400.00Hz（低频），0.0-4000.0Hz（高频）
- **步进级别：** 4级（0.01Hz→0.1Hz→1Hz→10Hz）
- **显示精度：** 2位小数（低频），1位小数（高频）

## 🔧 开发建议

### 代码组织
- 按功能模块组织代码
- 保持接口清晰
- 添加详细注释

### 调试技巧
- 使用Keil调试器
- 检查SPI波形
- 单独测试模块

### 维护建议
- 定期检查代码质量
- 更新HAL库版本
- 维护文档同步

---

**最后更新：** 2025-10-25
