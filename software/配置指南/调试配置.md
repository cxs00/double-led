# 调试配置指南

## 🎯 概述

本指南将帮助您配置STM32 500双LED项目的调试环境，包括调试器设置、调试接口配置、调试选项等。

## 🔧 调试器配置

### 1. 调试器选择
- **推荐调试器：** J-Link V9
- **替代调试器：** ST-Link V2
- **接口类型：** SWD（推荐）或JTAG
- **连接方式：** 4线连接

### 2. J-Link配置
```
调试器：J-Link / J-Trace Cortex
接口：SWD
端口：SW
速度：1000 kHz
复位：连接时复位
```

### 3. ST-Link配置
```
调试器：ST-Link Debugger
接口：SWD
端口：SW
速度：1000 kHz
复位：连接时复位
```

## 🔌 硬件连接

### 1. SWD连接（推荐）
```
STM32F103C8T6 ←→ 调试器
PA13 (SWDIO) ←→ SWDIO
PA14 (SWCLK) ←→ SWCLK
GND ←→ GND
VCC ←→ 3.3V
```

### 2. JTAG连接（不推荐）
```
STM32F103C8T6 ←→ 调试器
PA15 (JTDI) ←→ TDI
PB3 (JTDO) ←→ TDO
PA13 (JTMS) ←→ TMS
PA14 (JTCK) ←→ TCK
GND ←→ GND
VCC ←→ 3.3V
```

### 3. 连接检查
```
步骤：
1. 检查硬件连接
2. 验证电源电压
3. 确认接口设置
4. 测试连接状态

预期结果：
- 连接成功
- 电源稳定
- 接口正常
- 状态良好
```

## ⚙️ 调试设置

### 1. 调试选项
```
Debug → Use: J-Link / J-Trace Cortex
Debug → Settings → Debug → Port: SW (不选JTAG)
Debug → Settings → Flash Download → Programming Algorithm: STM32F10x Med-density (64KB)
Debug → Settings → Flash Download → Reset and Run: 启用
```

### 2. Flash算法配置
```
算法：STM32F10x Med-density (64KB)
地址：0x08000000
大小：0x10000
擦除：全片擦除
验证：启用
```

### 3. 调试接口配置
```
接口：SWD
端口：SW
速度：1000 kHz
复位：连接时复位
时钟：内部时钟
```

## 🔍 调试功能

### 1. 基本调试
```
功能：
- 断点设置
- 单步执行
- 变量监视
- 内存查看
- 寄存器查看

操作：
- F5：运行
- F10：单步
- F11：进入函数
- Shift+F11：跳出函数
- Ctrl+F5：运行到光标
```

### 2. 高级调试
```
功能：
- 条件断点
- 数据断点
- 调用栈查看
- 反汇编查看
- 性能分析

操作：
- 右键断点：设置条件
- 监视窗口：添加变量
- 调用栈：查看函数调用
- 反汇编：查看汇编代码
```

### 3. 实时调试
```
功能：
- 实时变量监视
- 实时内存查看
- 实时寄存器查看
- 实时波形显示

操作：
- 监视窗口：添加变量
- 内存窗口：查看内存
- 寄存器窗口：查看寄存器
- 波形窗口：显示波形
```

## ⚠️ 常见问题

### 1. 连接问题
**问题：** 无法连接调试器
**解决方案：**
- 检查硬件连接
- 验证驱动安装
- 确认接口设置
- 检查电源稳定

### 2. 烧录问题
**问题：** 程序烧录失败
**解决方案：**
- 检查Flash算法
- 验证芯片型号
- 确认电源稳定
- 检查连接状态

### 3. 调试问题
**问题：** 调试功能异常
**解决方案：**
- 检查调试器设置
- 验证程序完整性
- 确认调试信息
- 重新连接调试器

## 📊 调试性能

### 1. 连接性能
```
连接时间：<5秒
烧录时间：<10秒
调试速度：1000 kHz
响应时间：<100ms
```

### 2. 调试功能
```
断点数量：无限制
变量监视：无限制
内存查看：无限制
寄存器查看：无限制
```

### 3. 稳定性
```
连接稳定性：高
调试稳定性：高
烧录稳定性：高
响应稳定性：高
```

## 🔧 高级调试

### 1. 条件断点
```c
// 设置条件断点
if (frequency > 100.0) {
    // 断点条件
}
```

### 2. 数据断点
```c
// 设置数据断点
volatile uint32_t *ptr = &current_frequency;
// 当*ptr改变时触发断点
```

### 3. 调用栈分析
```
功能：
- 查看函数调用链
- 分析程序流程
- 定位问题位置
- 优化程序结构
```

## 📚 调试技巧

### 1. 断点技巧
```
技巧：
- 在关键位置设置断点
- 使用条件断点
- 设置数据断点
- 分析断点信息
```

### 2. 变量监视
```
技巧：
- 监视关键变量
- 设置监视条件
- 分析变量变化
- 优化变量使用
```

### 3. 内存分析
```
技巧：
- 查看内存使用
- 分析内存泄漏
- 优化内存分配
- 检查内存边界
```

## 📚 相关文档

### 配置文档
- [开发环境配置.md](开发环境配置.md)
- [编译配置.md](编译配置.md)
- [硬件连接指南.md](硬件连接指南.md)

### 使用文档
- [使用说明](../使用说明/)
- [工程文件](../工程文件/)
- [故障经验](../故障经验/)

## 🎯 下一步

完成调试配置后，您可以：

1. **开始开发** - 查看 [使用说明](../使用说明/)
2. **了解项目** - 查看 [工程文件](../工程文件/)
3. **解决问题** - 查看 [故障经验](../故障经验/)

---

**版本：** v1.0  
**最后更新：** 2025-10-25  
**维护者：** STM32开发团队
